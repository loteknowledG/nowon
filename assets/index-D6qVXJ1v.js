import{r as i,j as n,_ as q}from"./index-1lqBQfz8.js";const p=(b="")=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}${b}`;function V(){const[b,c]=i.useState([{id:p(),role:"system",text:"Client-side @clack streaming demo — press Enter to send, Ctrl+C to cancel."}]),[U,a]=i.useState("Give me a playful one‑line summary of nowon"),[y,I]=i.useState(!1),$=i.useRef(!1),_=i.useRef(null),D=i.useRef(null),l=i.useRef(null),[f,L]=i.useState([]),[E,m]=i.useState(-1);i.useEffect(()=>{var e;(e=D.current)==null||e.scrollTo({top:D.current.scrollHeight,behavior:"smooth"})},[b,y]),i.useEffect(()=>{var e;(e=l.current)==null||e.focus()},[]);const k=e=>c(t=>[...t,{id:p(),...e}]);async function G(e){I(!0),$.current=!1;const t=p("a");c(d=>[...d,{id:t,role:"assistant",text:""}]);const C=(`Streaming reply for: "${e}" — this is a client-side simulation of @clack/prompts stream.`+" It supports cancel (Ctrl+C), task logs, and a typing-like streaming animation.").repeat(1);for(let d=0;d<C.length;d+=6){if($.current){c(h=>h.map(s=>s.id===t?{...s,text:s.text+`

[stream cancelled]`}:s)),I(!1);return}const N=C.slice(d,d+6);c(h=>h.map(s=>s.id===t?{...s,text:s.text+N}:s)),await new Promise(h=>setTimeout(h,20+Math.random()*40))}I(!1)}function M(){y&&($.current=!0)}i.useEffect(()=>{const e=t=>{const o=document.activeElement;!_.current||!_.current.contains(o)||((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="c"&&(t.preventDefault(),M()),t.key==="Escape"&&(t.preventDefault(),M()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y]),i.useEffect(()=>{const e=t=>{var u;const o=t==null?void 0:t.detail;!o||typeof o.text!="string"||(a(String(o.text)),m(-1),(u=l.current)==null||u.focus())};return window.addEventListener("nowon:insert-into-clack",e),()=>window.removeEventListener("nowon:insert-into-clack",e)},[]);async function F(){var t,o,u,C,d,N,h;const e=U.trim();if(e){if(e.startsWith("/")){const[s,...z]=e.split(" "),B=z.join(" ");if(s==="/figlet"){const P=B||"nowon";k({role:"assistant",text:"Generating ASCII..."});try{const g=await q(()=>import("./figlet-Dsjz5JCJ.js"),[]),w=g&&g.default||g,T=`${(()=>{const r="/nowon/tui-ftw/";if(typeof r=="string"&&r!=="/")return r.replace(/\/$/,"");try{const v=new URL(document.baseURI).pathname.split("/").filter(Boolean)[0];return v?`/${v}`:""}catch{return""}})()}/fonts`;try{w.defaults&&w.defaults({fontPath:T,fetchFontIfMissing:!0})}catch{}const j=(r,x={horizontalLayout:"default"})=>new Promise((v,S)=>w.text(r,x,(K,W)=>K?S(K):v(W)));let R;try{R=await j(P)}catch(r){if(String((r==null?void 0:r.message)||r).includes("FIGlet header contains invalid values"))try{R=await j(P,{font:"Standard",horizontalLayout:"default"}),c(v=>{const S=v.slice();return S[S.length-1]={id:p(),role:"assistant",text:R+`

[rendered with fallback font: Standard — original font header invalid]`},S}),a(""),(t=l.current)==null||t.focus();return}catch{throw r}throw r}c(r=>{const x=r.slice();return x[x.length-1]={id:p(),role:"assistant",text:R},x})}catch(g){const w=String((g==null?void 0:g.message)||String(g)),A=w.includes("FIGlet header contains invalid values")?`${w} — try the Figlet demo and select a different font.`:w;c(T=>{const j=T.slice();return j[j.length-1]={id:p(),role:"assistant",text:`figlet error: ${A}`},j})}finally{a(""),(o=l.current)==null||o.focus()}return}if(s==="/clear"){c([{id:p(),role:"system",text:"Console cleared."}]),L([]),m(-1),a(""),(u=l.current)==null||u.focus();return}if(s==="/help"){k({role:"system",text:"Commands: /help, /clear, /history, /figlet <text>"}),a(""),(C=l.current)==null||C.focus();return}if(s==="/history"){k({role:"system",text:f.length?f.join(`
`):"No history"}),a(""),(d=l.current)==null||d.focus();return}k({role:"system",text:`Unknown command: ${s}`}),a(""),(N=l.current)==null||N.focus();return}k({role:"user",text:e}),L(s=>[...s,e].slice(-100)),m(-1),a(""),(h=l.current)==null||h.focus(),G(e)}}function H(e){var u;const t=(u=e.target.files)==null?void 0:u[0];if(!t)return;const o=new FileReader;o.onload=()=>{k({role:"system",text:`Uploaded ${t.name} (${Math.round(String(o.result||"").length/1024)} KB)`})},o.readAsText(t),e.currentTarget.value=""}return n.jsxs("div",{className:"ai-tui",ref:_,role:"region","aria-label":"@clack demo",children:[n.jsxs("div",{className:"tui-header",children:[n.jsxs("div",{className:"tui-left",children:[n.jsx("strong",{children:"@clack/prompts — client demo"}),n.jsx("div",{style:{fontSize:12,color:"var(--muted)"},children:"Streaming + cancel (Ctrl+C)"})]}),n.jsxs("div",{className:"tui-controls",children:[n.jsx("input",{className:"tui-key",placeholder:"(session only)",style:{minWidth:160},disabled:!0,value:"demo-key-not-required"}),n.jsxs("label",{className:"btn ghost",style:{padding:"6px 8px",borderRadius:8},children:["Upload",n.jsx("input",{type:"file",onChange:H,style:{display:"none"}})]}),n.jsx("button",{className:"btn ghost",onClick:()=>{var e;c([{id:p(),role:"system",text:"Cleared demo messages."}]),L([]),m(-1),(e=l.current)==null||e.focus()},children:"Clear"})]})]}),n.jsx("div",{className:"tui-messages",ref:D,children:b.map(e=>n.jsxs("div",{className:`tui-message tui-${e.role}`,children:[n.jsx("div",{className:"tui-meta",children:e.role==="user"?"nowon>":e.role}),n.jsx("pre",{className:"tui-text",children:e.text||(e.role==="assistant"&&y?"…":"")})]},e.id))}),n.jsxs("div",{className:"tui-input-row",children:[n.jsx("input",{ref:l,className:"tui-input",value:U,onChange:e=>{a(e.target.value),m(-1)},onKeyDown:e=>{if(e.key==="Enter"){e.preventDefault(),F();return}if(e.key==="ArrowUp"){if(e.preventDefault(),f.length===0)return;const t=E===-1?f.length-1:Math.max(0,E-1);m(t),a(f[t]);return}if(e.key==="ArrowDown"){if(e.preventDefault(),f.length===0)return;if(E===-1){a("");return}const t=E+1;t>=f.length?(m(-1),a("")):(m(t),a(f[t]));return}},placeholder:"Type and press Enter — use /help or /clear"}),n.jsx("button",{className:"btn",onClick:F,disabled:y,children:y?"Streaming…":"Send"}),n.jsx("button",{className:"btn ghost",onClick:M,disabled:!y,children:"Cancel (Ctrl+C)"})]}),n.jsxs("div",{className:"tui-hint",children:["Hints: press ",n.jsx("kbd",{children:"Enter"})," to send · ",n.jsx("kbd",{children:"Ctrl"}),"+",n.jsx("kbd",{children:"C"})," to cancel streaming · Try ",n.jsx("code",{children:"/figlet hello"})," · Upload adds memory (mock)"]})]})}export{V as default};
