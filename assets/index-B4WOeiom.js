import{r as f,_ as O,j as r}from"./index-FGhwL14h.js";const x=(R="")=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}${R}`;function nt(){const[R,p]=f.useState([{id:x(),role:"system",text:"Figlet TUI — type `help` for commands. Try: `figlet hello`"}]),[T,w]=f.useState(""),[v,A]=f.useState([]),[I,j]=f.useState(-1),[L,K]=f.useState([]),[S,N]=f.useState("Standard"),[q,V]=f.useState(12),[b,C]=f.useState(!1),[et,W]=f.useState([]),[_,G]=f.useState(""),[z,Y]=f.useState(!0),J=f.useRef(null),F=f.useRef(!1),E=f.useRef(null),P=f.useRef(null),[Q,M]=f.useState(!1),[X,D]=f.useState(0);f.useEffect(()=>{var t;(t=P.current)==null||t.focus()},[]),f.useEffect(()=>{var t;(t=E.current)==null||t.scrollTo({top:E.current.scrollHeight,behavior:"smooth"})},[R,b]),f.useEffect(()=>{(async()=>{try{const t=await O(()=>import("./figlet-Dsjz5JCJ.js"),[]),s=t&&t.default||t,h=(()=>{const e="/nowon/";if(typeof e=="string"&&e!=="/")return e.replace(/\/$/,"");try{const a=new URL(document.baseURI).pathname.split("/").filter(Boolean)[0];return a?`/${a}`:""}catch{return""}})();try{s.defaults&&s.defaults({fontPath:`${h}/fonts`,fetchFontIfMissing:!0})}catch{}const c=await new Promise((e,u)=>s.fonts((a,n)=>a?u(a):e(n)));K(c),N(e=>e||c[0]||"Standard"),(async()=>{try{const e=[{font:"Banner3-D",text:"FONTS",color:"#FF8A8A",size:48},{font:"Tiny",text:"TINY FONT DEMO",color:"#FFFFFF",size:14},{font:"Block",text:"HI 2025",color:"#FFD54F",size:32},{font:"Shade",text:"SHADE FONT DEMO",color:"#FFFFFF",size:14}],u=[];for(const a of e)try{await s.loadFont(a.font).catch(()=>{});const n=await new Promise((i,l)=>s.text(a.text,{font:a.font},(o,d)=>o?l(o):i(d)));u.push({font:a.font,art:n,color:a.color,size:a.size})}catch{}F.current||W(u)}catch{}})(),setTimeout(()=>{N(e=>e||(c&&c.length?c[0]:"Standard"))},10),localStorage.getItem("figlet-fonts-preloaded")||(async()=>{try{M(!0);for(let e=0;e<c.length&&!F.current;e++)await s.loadFont(c[e]).catch(()=>{}),D(Math.round((e+1)/c.length*100));localStorage.setItem("figlet-fonts-preloaded","1")}finally{M(!1),setTimeout(()=>D(0),500)}})()}catch{}})()},[]);function m(t){p(s=>[...s,{id:x(),...t}])}async function U(t,s){const h=t||"";m({role:"user",text:`figlet ${h}`});const c=await O(()=>import("./figlet-Dsjz5JCJ.js"),[]),e=c&&c.default||c,u="/nowon/".replace(/\/$/,"");try{e.defaults&&e.defaults({fontPath:`${u}/fonts`,fetchFontIfMissing:!0})}catch{}if(s!=null&&s.stream){C(!0),F.current=!1;const a=x("a");p(n=>[...n,{id:a,role:"assistant",text:""}]);try{let n;try{n=await new Promise((i,l)=>e.text(h||" ",{font:S},(o,d)=>o?l(o):i(d)))}catch(i){const l=String((i==null?void 0:i.message)||i||"");if(l.includes("FIGlet header contains invalid values")||l.includes("Network response was not ok"))try{await e.loadFont("Standard"),n=await new Promise((o,d)=>e.text(h||" ",{font:"Standard"},(g,y)=>g?d(g):o(y))),n=n+`

[fallback: rendered with Standard because the selected font failed]`}catch(o){throw o||i}else throw i}for(let i=0;i<n.length;i+=4){if(F.current){p(o=>o.map(d=>d.id===a?{...d,text:d.text+`
[stream cancelled]`}:d)),C(!1);return}const l=n.slice(i,i+4);p(o=>o.map(d=>d.id===a?{...d,text:d.text+l}:d)),await new Promise(o=>setTimeout(o,12+Math.random()*30))}}catch(n){const i=String((n==null?void 0:n.message)||String(n));p(l=>{const o=l.slice();return o[o.length-1]={id:x(),role:"assistant",text:`figlet error: ${i}`},o}),(async()=>{try{const o=`${(()=>{const k="/nowon/";if(typeof k=="string"&&k!=="/")return k.replace(/\/$/,"");try{const B=new URL(document.baseURI).pathname.split("/").filter(Boolean)[0];return B?`/${B}`:""}catch{return""}})()}/fonts/${encodeURIComponent(S)}.flf`,d=await fetch(o,{cache:"no-cache"}),y=(await d.text()).slice(0,200).replace(/\s+/g," ").trim(),$=/<!doctype|<html|<meta|<script/i.test(y);p(k=>[...k,{id:x(),role:"system",text:`font URL: ${o} — status: ${d.status}${$?" (HTML returned)":""}`},{id:x(),role:"system",text:`response snippet: ${y}`}])}catch(l){p(o=>[...o,{id:x(),role:"system",text:`font diagnostic failed: ${String(l)}`}])}})()}finally{C(!1)}return}try{let a;try{a=await new Promise((n,i)=>e.text(h||" ",{font:S},(l,o)=>l?i(l):n(o)))}catch(n){const i=String((n==null?void 0:n.message)||n||"");if(i.includes("FIGlet header contains invalid values")||i.includes("Network response was not ok"))try{await e.loadFont("Standard");const l=await new Promise((o,d)=>e.text(h||" ",{font:"Standard"},(g,y)=>g?d(g):o(y)));m({role:"assistant",text:l+`

[fallback: rendered with Standard because the selected font failed]`});return}catch(l){n=l||n}throw n}m({role:"assistant",text:a})}catch(a){const n=String((a==null?void 0:a.message)||String(a));m({role:"assistant",text:`figlet error: ${n}`}),(async()=>{try{const l=`${(()=>{try{const $=new URL(document.baseURI).pathname;return $.endsWith("/")?$.slice(0,-1):$}catch{return""}})()}/fonts/${encodeURIComponent(S)}.flf`,o=await fetch(l,{cache:"no-cache"}),g=(await o.text()).slice(0,200).replace(/\s+/g," ").trim(),y=/<!doctype|<html|<meta|<script/i.test(g);m({role:"system",text:`font URL: ${l} — status: ${o.status}${y?" (HTML returned)":""}`}),m({role:"system",text:`response snippet: ${g}`})}catch(i){m({role:"system",text:`font diagnostic failed: ${String(i)}`})}})()}}function Z(t){const s=t.trim();if(!s)return;const h=s.split(/\s+/),c=h[0].toLowerCase(),e=h.slice(1).join(" ");if(c==="help"){m({role:"system",text:"Commands: figlet [-s] <text>, font <name>, size <n>, list-fonts [q], clear, help"});return}if(c==="clear"){p([{id:x(),role:"system",text:"Figlet TUI — type `help` for commands."}]);return}if(c==="font"){if(!e){m({role:"system",text:`current font: ${S}`});return}if(!L.includes(e)){m({role:"system",text:`font not found: ${e}`});return}N(e),m({role:"system",text:`font set to ${e}`});return}if(c==="size"){const u=Number(e);if(!Number.isFinite(u)||u<=0){m({role:"system",text:`invalid size: ${e}`});return}V(Math.max(6,Math.min(64,Math.round(u)))),m({role:"system",text:`size set to ${u}`});return}if(c==="list-fonts"){const u=e.toLowerCase(),a=L.filter(n=>!u||n.toLowerCase().includes(u)).slice(0,80);m({role:"system",text:a.join(", ")||"no matches"});return}if(c==="figlet"){const u=h[1]==="-s"||h[1]==="--stream",a=u?h.slice(2).join(" "):h.slice(1).join(" ");U(a,{stream:u});return}U(s,{})}function H(){const t=T.trim();t&&(A(s=>[...s,t].slice(-200)),j(-1),w(""),Z(t))}return f.useEffect(()=>{const t=s=>{(s.ctrlKey||s.metaKey)&&s.key.toLowerCase()==="c"&&b&&(s.preventDefault(),F.current=!0)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[b]),r.jsxs("div",{className:"ai-tui",role:"region","aria-label":"Figlet TUI demo",style:{minHeight:320},children:[r.jsxs("div",{className:"tui-header",children:[r.jsxs("div",{className:"tui-left",children:[r.jsx("strong",{children:"Figlet TUI"}),r.jsxs("div",{style:{fontSize:12,color:"var(--muted)"},children:["Type commands (e.g. ",r.jsx("code",{children:"figlet hello"}),")"]})]}),r.jsxs("div",{className:"tui-controls",children:[r.jsx("div",{style:{color:"var(--muted)",fontSize:12},children:Q?`Preloading fonts ${X}%`:"Fonts preloaded: "+(localStorage.getItem("figlet-fonts-preloaded")?"yes":"no")}),r.jsx("div",{style:{marginLeft:12},children:r.jsx("button",{className:"btn ghost",onClick:async()=>{const t="npm run opentui:figlet";try{await navigator.clipboard.writeText(t),m({role:"system",text:`Native demo command copied to clipboard: ${t}`})}catch{m({role:"system",text:`Run in terminal: ${t}`})}},style:{whiteSpace:"nowrap"},children:"Run native demo"})})]})]}),r.jsxs("div",{style:{display:"flex",gap:12,marginBottom:12},children:[r.jsxs("div",{style:{width:260,background:"rgba(255,255,255,0.01)",borderRadius:8,padding:8,border:"1px solid rgba(255,255,255,0.03)"},children:[r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[r.jsx("strong",{style:{fontSize:13},children:"Fonts"}),r.jsx("input",{placeholder:"Filter fonts...",value:_,onChange:t=>G(t.target.value),style:{flex:1,padding:"6px 8px",borderRadius:6,border:"1px solid rgba(255,255,255,0.03)",background:"transparent",color:"inherit"}}),r.jsx("button",{className:"btn ghost",onClick:()=>Y(t=>!t),style:{whiteSpace:"nowrap"},children:z?"Hide":"Show"})]}),z&&r.jsx("div",{ref:J,style:{maxHeight:220,overflow:"auto",fontFamily:"'Hack','VT323',monospace",fontSize:13},children:L.filter(t=>!_||t.toLowerCase().includes(_.toLowerCase())).map(t=>r.jsx("div",{onClick:()=>{N(t),m({role:"system",text:`font set to ${t}`})},style:{padding:"6px 8px",borderRadius:6,background:t===S?"linear-gradient(90deg,#00e6a8,#7b61ff)":"transparent",color:t===S?"#041024":"var(--muted)",cursor:"pointer",marginBottom:6},children:t},t))})]}),r.jsxs("div",{style:{flex:1},children:[!1,R.map(t=>r.jsxs("div",{className:`tui-message tui-${t.role}`,children:[r.jsx("div",{className:"tui-meta",children:t.role==="user"?"you>":t.role}),r.jsx("pre",{className:"tui-text",style:{fontSize:t.role==="assistant"?q:void 0},children:t.text})]},t.id))]})]}),r.jsxs("div",{className:"tui-input-row",children:[r.jsx("input",{ref:P,className:"tui-input",value:T,onChange:t=>{w(t.target.value),j(-1)},onKeyDown:t=>{if(t.key==="Enter"){t.preventDefault(),H();return}if(t.key==="ArrowUp"){if(t.preventDefault(),v.length===0)return;const s=I===-1?v.length-1:Math.max(0,I-1);j(s),w(v[s]||"");return}if(t.key==="ArrowDown"){if(t.preventDefault(),v.length===0)return;if(I===-1){w("");return}const s=I+1;s>=v.length?(j(-1),w("")):(j(s),w(v[s]));return}if(t.key==="Tab"&&T.startsWith("font ")){t.preventDefault();const s=T.slice(5).toLowerCase(),h=L.find(c=>c.toLowerCase().startsWith(s));h&&w(`font ${h}`)}},placeholder:"Type command — try: figlet hello"}),r.jsx("button",{className:"btn",onClick:H,disabled:b,children:b?"Streaming…":"Send"}),r.jsx("button",{className:"btn ghost",onClick:()=>{F.current=!0,C(!1)},disabled:!b,children:"Cancel (Ctrl+C)"})]}),r.jsxs("div",{className:"tui-hint",children:["Hints: ",r.jsx("kbd",{children:"Enter"})," send · ",r.jsx("kbd",{children:"↑/↓"})," history · try ",r.jsx("code",{children:"list-fonts"})," · ",r.jsx("code",{children:"font Slant"})]})]})}export{nt as default};
